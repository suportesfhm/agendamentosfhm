<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Agende sua Visita - Maternidade</title>
  <link rel="icon" href="data:,">
  <style>
    :root{
      --container-width: 980px;
      --gap: 18px;
      --accent: #d94f72;
      --btn: #007b8f;
      --bg: #fff7f9;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color:#333;
    }

    .container{
      max-width: var(--container-width);
      margin:40px auto;
      background:#fff;
      padding:28px;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
    }

    h1{
      color: var(--accent);
      margin:0 0 6px;
      font-size:26px;
    }

    p.lead{
      margin:0 0 22px;
      color:#666;
      line-height:1.45;
    }

    .form-grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: var(--gap);
      align-items:start;
    }

    .field{
      display:flex;
      flex-direction:column;
    }

    label{
      font-weight:600;
      margin-bottom:6px;
      font-size:13px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    select,
    textarea{
      border:1px solid #d0d0d0;
      border-radius:8px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
      transition:box-shadow .15s, border-color .15s;
    }

    input:focus, select:focus, textarea:focus{
      box-shadow:0 0 0 3px rgba(0,123,140,0.07);
      border-color:#9fbecd;
    }

    textarea{ min-height:90px; resize:vertical; }

    .span-12{ grid-column: span 12; }
    .span-8{ grid-column: span 8; }
    .span-7{ grid-column: span 7; }
    .span-6{ grid-column: span 6; }
    .span-5{ grid-column: span 5; }
    .span-4{ grid-column: span 4; }
    .span-3{ grid-column: span 3; }

    .alerta{
      font-weight:700;
      margin-top:6px;
    }
    .alerta ul{ margin:8px 0 0 0; padding-left:16px; font-weight:600; color:#444; }
    .alerta li{ margin:6px 0; }

    .checkbox-row{
      display:flex;
      align-items:center;
      gap:12px;
      font-size:14px;
      line-height:1.2;
    }
    .checkbox-row input[type="checkbox"]{
      width:18px; height:18px;
      margin:0;
    }

    .actions{ text-align:center; margin-top:6px; }
    button{
      background: var(--btn);
      color:#fff;
      border:none;
      padding:12px 22px;
      border-radius:8px;
      font-size:15px;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    button:hover{ filter:brightness(.93); }
    button:disabled{
      background: #cccccc;
      cursor: not-allowed;
    }

    .loading{
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .message{
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      text-align: center;
      font-weight: 500;
    }

    .message.success{
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.error{
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    @media (max-width:800px){
      .form-grid{ grid-template-columns: 1fr; gap:14px; }
      .field{ grid-column: 1 / -1; }
      .actions{ text-align:left; }
    }

    .small-note{ color:#777; font-size:13px; margin-top:10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Agende sua Visita</h1>
    <p class="lead">Teremos o maior prazer em receber voc√™ e um acompanhante para uma visita guiada √† nossa maternidade.</p>

    <form id="agendamentoForm" class="form-grid" novalidate>
      <div class="field span-7">
        <label for="nome">Nome Completo *</label>
        <input id="nome" name="nome" type="text" required>
      </div>

      <div class="field span-5">
        <label for="email">E-mail *</label>
        <input id="email" name="email" type="email" required>
      </div>

      <div class="field span-3">
        <label for="telefone">Telefone *</label>
        <input id="telefone" name="telefone" type="tel" placeholder="(00) 00000-0000" required maxlength="15">
      </div>

      <div class="field span-3">
        <label for="gestacao">Semana de Gesta√ß√£o *</label>
        <input id="gestacao" name="gestacao" type="number" min="1" max="42" required>
      </div>

      <div class="field span-6">
        <label for="obstetra">Obstetra *</label>
        <input id="obstetra" name="obstetra" type="text" required>
      </div>

      <div class="field span-4">
        <label for="cidade">Cidade *</label>
        <input id="cidade" name="cidade" type="text" required>
      </div>

      <div class="field span-8">
        <label for="bairro">Bairro *</label>
        <input id="bairro" name="bairro" type="text" required>
      </div>

      <div class="field span-3">
        <label for="data">Data *</label>
        <input id="data" name="data" type="date" required>
      </div>

      <div class="field span-3">
        <label for="horario">Hor√°rio *</label>
        <select id="horario" name="horario" required>
          <option value="">Selecione...</option>
        </select>
      </div>

      <div class="field span-3">
        <label for="plano">Possui plano de sa√∫de? *</label>
        <select id="plano" name="plano" required>
          <option value="">Selecione...</option>
          <option value="Sim">Sim</option>
          <option value="N√£o">N√£o</option>
        </select>
      </div>

      <div class="field span-3" id="field-qualplano" style="display:none;">
        <label for="qualplano">Se sim, qual?</label>
        <input id="qualplano" name="qualplano" type="text">
      </div>

      <div class="field span-6">
        <label for="conheceu">Como conheceu a maternidade? *</label>
        <select id="conheceu" name="conheceu" required>
          <option value="">Selecione...</option>
          <option>Indica√ß√£o de amigo(a)</option>
          <option>Redes sociais</option>
          <option>M√©dico</option>
          <option>Outros</option>
        </select>
      </div>

      <div class="field span-6">
        <label for="obs">Observa√ß√µes</label>
        <textarea id="obs" name="obs"></textarea>
      </div>

      <div class="span-12">
        <div class="alerta">
          Aten√ß√£o:
          <ul>
            <li>Voc√™ poder√° levar apenas um acompanhante.</li>
            <li>Toler√¢ncia para atraso de no m√°ximo 15 minutos.</li>
            <li>Hor√°rios dispon√≠veis conforme o dia da semana.</li>
          </ul>
        </div>
      </div>

      <div class="span-12">
        <label class="checkbox-row">
          <input id="termos" name="termos" type="checkbox" required>
          Li e aceito os termos de uso dos dados conforme indicado na Pol√≠tica de Privacidade.
        </label>
      </div>

      <div class="span-12">
        <div id="messageContainer"></div>
      </div>

      <div class="span-12 actions">
        <button type="submit" id="submitBtn">
          <span class="btn-text">Agendar Visita</span>
        </button>
        <div class="small-note">* Campos obrigat√≥rios</div>
      </div>
    </form>
  </div>

  <script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbymcGV_VzLEae1NS6_sJ6w8lsPmc1VJyjHfXSVXpE-lspXy63gc3Khtkujuowtv-qDW/exec";

const selectHorario = document.getElementById('horario');
const inputData = document.getElementById('data');
const submitBtn = document.getElementById('submitBtn');
const btnText = submitBtn.querySelector('.btn-text');
const messageContainer = document.getElementById('messageContainer');

// ‚úÖ JSONP retorno de hor√°rios
window.handleHorarios = function(data) {
  console.log("üì• Retorno JSONP:", data);
  selectHorario.innerHTML = '<option value="">Selecione...</option>';
  
  if (data.status === 'ok' && Array.isArray(data.horarios)) {
    if (data.horarios.length > 0) {
      data.horarios.forEach(h => {
        const opt = document.createElement('option');
        opt.value = h;
        opt.textContent = h;
        selectHorario.appendChild(opt);
      });
    } else {
      selectHorario.innerHTML = '<option value="">Sem hor√°rios dispon√≠veis</option>';
    }
  } else {
    selectHorario.innerHTML = '<option value="">Erro ao carregar hor√°rios</option>';
  }

  selectHorario.disabled = false;
};

// ‚úÖ JSONP retorno do agendamento
window.handleAgendamento = function(data) {
  setLoading(false);
  if (data.status === 'ok') {
    mostrarMensagem('‚úÖ Agendamento realizado com sucesso! Em breve entraremos em contato.', 'success');
    document.getElementById('agendamentoForm').reset();
    selectHorario.innerHTML = '<option value="">Selecione...</option>';
    document.getElementById('field-qualplano').style.display = 'none';
  } else {
    mostrarMensagem('‚ùå ' + (data.message || 'Erro ao realizar agendamento'), 'error');
  }
};

// ‚úÖ Carregar hor√°rios
function carregarHorariosParaData(dataSelecionada) {
  selectHorario.innerHTML = '<option value="">Carregando...</option>';
  selectHorario.disabled = true;
  
  if (!dataSelecionada) {
    selectHorario.innerHTML = '<option value="">Selecione uma data</option>';
    selectHorario.disabled = false;
    return;
  }

  try {
    const callbackName = 'handleHorarios';
    const url = `${WEB_APP_URL}?data=${encodeURIComponent(dataSelecionada)}&callback=${callbackName}&_=${Date.now()}`;

    // Remove scripts antigos
    document.querySelectorAll('script[data-jsonp]').forEach(s => s.remove());

    const script = document.createElement('script');
    script.src = url;
    script.dataset.jsonp = 'true';

    script.onerror = () => {
      console.error("‚ùå Erro ao conectar ao Apps Script");
      selectHorario.innerHTML = '<option value="">Erro de conex√£o</option>';
      selectHorario.disabled = false;
    };

    // For√ßa timeout caso nada carregue em 5 segundos
    const timeout = setTimeout(() => {
      selectHorario.innerHTML = '<option value="">Erro ao carregar hor√°rios</option>';
      selectHorario.disabled = false;
    }, 5000);

    window[callbackName] = (data) => {
      clearTimeout(timeout);
      if (data.status === 'ok' && Array.isArray(data.horarios)) {
        selectHorario.innerHTML = '<option value="">Selecione...</option>';
        data.horarios.forEach(h => {
          const opt = document.createElement('option');
          opt.value = h;
          opt.textContent = h;
          selectHorario.appendChild(opt);
        });
      } else {
        selectHorario.innerHTML = '<option value="">Sem hor√°rios dispon√≠veis</option>';
      }
      selectHorario.disabled = false;
    };

    document.head.appendChild(script);
  } catch (err) {
    console.error("‚ùå Exce√ß√£o ao carregar hor√°rios:", err);
    selectHorario.innerHTML = '<option value="">Erro inesperado</option>';
    selectHorario.disabled = false;
  }
}
// Mostrar mensagem
function mostrarMensagem(msg, tipo) {
  messageContainer.innerHTML = `<div class="message ${tipo}">${msg}</div>`;
  if (tipo === 'success') setTimeout(() => messageContainer.innerHTML = '', 5000);
}

function setLoading(loading) {
  if (loading) {
    submitBtn.disabled = true;
    btnText.innerHTML = '<div class="loading"></div>Enviando...';
  } else {
    submitBtn.disabled = false;
    btnText.textContent = 'Agendar Visita';
  }
}

// Mostrar/ocultar campo "qual plano"
document.getElementById('plano').addEventListener('change', e => {
  const field = document.getElementById('field-qualplano');
  const input = document.getElementById('qualplano');
  if (e.target.value === 'Sim') {
    field.style.display = 'flex';
    input.required = true;
  } else {
    field.style.display = 'none';
    input.required = false;
    input.value = '';
  }
});

// Envio do formul√°rio
document.getElementById('agendamentoForm').addEventListener('submit', e => {
  e.preventDefault();

  if (!document.getElementById('termos').checked) {
    mostrarMensagem('Voc√™ precisa aceitar os termos antes de enviar.', 'error');
    return;
  }

  const dados = {
    nome: nome.value.trim(),
    email: email.value.trim(),
    telefone: telefone.value.trim(),
    semanaGestacao: gestacao.value.trim(),
    obstetra: obstetra.value.trim(),
    cidade: cidade.value.trim(),
    bairro: bairro.value.trim(),
    data: data.value,
    horario: horario.value,
    planoSaude: plano.value,
    qualPlano: qualplano.value.trim(),
    comoConheceu: conheceu.value,
    observacoes: obs.value.trim()
  };

  if (!dados.nome || !dados.email || !dados.telefone || !dados.data || !dados.horario) {
    mostrarMensagem('Preencha todos os campos obrigat√≥rios.', 'error');
    return;
  }

  setLoading(true);
  mostrarMensagem('', '');

  const urlParams = new URLSearchParams(dados);
  urlParams.append('callback', 'handleAgendamento');

  const scriptAntigo = document.getElementById('agendamento-script');
  if (scriptAntigo) scriptAntigo.remove();

  const script = document.createElement('script');
  script.id = 'agendamento-script';
  script.src = `${WEB_APP_URL}?${urlParams.toString()}`;
  script.onerror = () => {
    mostrarMensagem('‚ùå Erro de conex√£o. Tente novamente.', 'error');
    setLoading(false);
  };
  document.head.appendChild(script);
});

console.log("‚úÖ Sistema de agendamento carregado!");
  </script>
</body>
</html>


